<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFD Analyzer Pro - Com Notifica√ß√µes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.0.2/dist/browser.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { background-color: var(--bg-dark); color: var(--text-primary); padding-bottom: 50px; }

        /* Header */
        header { 
            background: var(--bg-card); 
            padding: 1rem 2rem; 
            border-bottom: 1px solid #334155; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title h1 { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); }
        .header-title p { font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem; }

        .header-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }

        .btn { 
            padding: 0.5rem 1rem; 
            border-radius: 6px; 
            border: none; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #059669; }
        
        .btn-warning { background: var(--warning); color: #000; }
        .btn-warning:hover { background: #d97706; }
        
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { background: #dc2626; }

        .btn-outline { background: transparent; border: 1px solid var(--text-secondary); color: var(--text-secondary); }
        .btn-outline:hover { border-color: var(--text-primary); color: var(--text-primary); }

        /* Status Bar */
        .status-bar { 
            background: #0f172a; 
            padding: 0.75rem 2rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid #334155;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .connection-status { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--danger); }
        .status-dot.connected { background: var(--success); animation: pulse 2s infinite; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }

        /* Grids */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }

        /* Cards */
        .card { 
            background: var(--bg-card); 
            border-radius: 12px; 
            padding: 1.5rem; 
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .card-title { font-size: 1rem; font-weight: 600; color: var(--text-primary); }

        /* Forms */
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary); }
        
        input, select { 
            width: 100%; 
            background: #0f172a; 
            border: 1px solid #334155; 
            color: white; 
            padding: 0.75rem; 
            border-radius: 6px; 
            font-size: 0.95rem;
        }

        input:focus, select:focus { outline: 2px solid var(--accent); border-color: transparent; }

        /* Price Display */
        .price-display {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            padding: 1.5rem;
            background: #0f172a;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .price-up { color: var(--success); }
        .price-down { color: var(--danger); }

        /* Signal Box */
        .signal-box {
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
            border: 3px solid;
        }

        .signal-buy { background: rgba(16, 185, 129, 0.1); border-color: var(--success); color: var(--success); }
        .signal-sell { background: rgba(239, 68, 68, 0.1); border-color: var(--danger); color: var(--danger); }
        .signal-neutral { background: rgba(148, 163, 184, 0.1); border-color: var(--text-secondary); color: var(--text-secondary); }

        .signal-strength { font-size: 1rem; margin-top: 0.5rem; opacity: 0.9; }
        .signal-reason { font-size: 0.85rem; margin-top: 1rem; opacity: 0.8; }

        /* Conflu√™ncia Meter */
        .confluencia-meter {
            height: 30px;
            background: #0f172a;
            border-radius: 15px;
            overflow: hidden;
            margin: 1rem 0;
            position: relative;
        }

        .confluencia-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            transition: width 0.5s ease;
        }

        .confluencia-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            font-size: 1.1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* Indicators Grid */
        .indicator-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem; }
        
        .indicator-item {
            background: #0f172a;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #334155;
        }

        .indicator-name { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; }
        .indicator-value { font-size: 1.1rem; font-weight: 600; }
        .indicator-signal { font-size: 0.7rem; margin-top: 0.25rem; }

        .signal-bullish { color: var(--success); }
        .signal-bearish { color: var(--danger); }
        .signal-neutral-text { color: var(--text-secondary); }

        /* Stats */
        .stat-card {
            background: #0f172a;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value { font-size: 1.8rem; font-weight: 700; display: block; margin-bottom: 0.5rem; }
        .stat-label { font-size: 0.85rem; color: var(--text-secondary); }

        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        
        th { 
            text-align: left; 
            color: var(--text-secondary); 
            font-size: 0.8rem; 
            padding: 0.75rem; 
            border-bottom: 2px solid #334155;
        }
        
        td { padding: 0.75rem; border-bottom: 1px solid #334155; font-size: 0.85rem; }
        
        .badge { 
            padding: 0.25rem 0.75rem; 
            border-radius: 4px; 
            font-size: 0.75rem; 
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-buy { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-sell { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-neutral { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }
        .badge-strong { background: rgba(245, 158, 11, 0.2); color: var(--warning); }

        /* Alerts */
        .alert-item {
            background: #0f172a;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .alert-time { font-size: 0.75rem; color: var(--text-secondary); }
        .alert-message { font-weight: 500; margin: 0.25rem 0; }

        /* Chart */
        .chart-container { position: relative; height: 400px; margin: 1rem 0; }

        /* Risk Warning */
        .risk-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--bg-card);
            border: 2px solid var(--accent);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            display: none;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #334155;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .price-display { font-size: 1.8rem; }
            header { padding: 1rem; }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden { display: none; }
    </style>
</head>
<body>

<!-- Header -->
<header>
    <div class="header-title">
        <h1>üìä CFD Analyzer Pro</h1>
        <p>A√ß√µes ¬∑ CFDs ¬∑ Backtesting ¬∑ Gest√£o de Risco ¬∑ <span class="text-success">‚úì Notifica√ß√µes</span></p>
    </div>
    <div class="header-actions">
        <button class="btn btn-outline" onclick="toggleSound()">üîî Som: <span id="soundStatus">OFF</span></button>
        <button class="btn btn-outline" onclick="requestNotificationPermission()">üîî Notifica√ß√µes</button>
        <button class="btn btn-primary" onclick="openModal('helpModal')">‚ùì Ajuda</button>
    </div>
</header>

<!-- Status Bar -->
<div class="status-bar">
    <div class="connection-status">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">A conectar...</span>
    </div>
    <div>
        <span id="currentAsset" class="badge badge-neutral">‚Äî</span>
        <span id="currentMode" class="badge badge-warning">A√á√ïES</span>
    </div>
    <div>
        <button class="btn btn-success" onclick="refreshData()">‚Üª</button>
        <button class="btn btn-primary" onclick="toggleAutoUpdate()">‚ñ∂ Auto</button>
    </div>
</div>

<div class="container">

    <!-- Risk Warning -->
    <div class="risk-warning">
        ‚ö†Ô∏è <strong>AVISO DE RISCO ‚Äî ESMA/XTB:</strong> CFDs s√£o instrumentos complexos e apresentam risco elevado de perda r√°pida de capital devido √† alavancagem. 
        Cerca de 75% das contas de investidores n√£o profissionais perdem dinheiro ao negociar CFDs. 
        Esta ferramenta √© educativa, n√£o constitui aconselhamento financeiro.
    </div>

    <!-- Asset Selection -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üîç Adicionar Ativo</span>
        </div>
        <div class="grid-4">
            <div class="form-group">
                <label>Symbol (Yahoo Finance)</label>
                <input type="text" id="assetSymbol" placeholder="Ex: AAPL, BTC-USD, EURUSD=X">
            </div>
            <div class="form-group">
                <label>Tipo</label>
                <select id="assetType">
                    <option value="acoes">üìà A√ß√µes (Spot)</option>
                    <option value="cfd">‚ö° CFDs (Alavancado)</option>
                    <option value="crypto">‚Çø Crypto</option>
                    <option value="forex">üí± Forex</option>
                    <option value="commodities">üõ¢Ô∏è Commodities</option>
                </select>
            </div>
            <div class="form-group">
                <label>Timeframe</label>
                <select id="timeframe">
                    <option value="1d">Di√°rio</option>
                    <option value="1wk">Semanal</option>
                    <option value="1mo">Mensal</option>
                </select>
            </div>
            <div class="form-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" style="width: 100%;" onclick="addAsset()">Adicionar</button>
            </div>
        </div>
    </div>

    <!-- Price & Signal -->
    <div class="grid-2">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìä Pre√ßo em Tempo Real</span>
                <span id="lastUpdate" style="font-size: 0.8rem; color: var(--text-secondary);">‚Äî</span>
            </div>
            <div class="price-display" id="currentPrice">
                ‚Äî
            </div>
            <div class="indicator-grid" id="indicatorsGrid">
                <div class="indicator-item">
                    <div class="indicator-name">RSI (14)</div>
                    <div class="indicator-value" id="rsiValue">‚Äî</div>
                    <div class="indicator-signal" id="rsiSignal">‚Äî</div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-name">ADX</div>
                    <div class="indicator-value" id="adxValue">‚Äî</div>
                    <div class="indicator-signal" id="adxSignal">‚Äî</div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-name">ATR</div>
                    <div class="indicator-value" id="atrValue">‚Äî</div>
                    <div class="indicator-signal">Volatilidade</div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-name">MACD</div>
                    <div class="indicator-value" id="macdValue">‚Äî</div>
                    <div class="indicator-signal" id="macdSignal">‚Äî</div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-name">SMA 20</div>
                    <div class="indicator-value" id="sma20Value">‚Äî</div>
                    <div class="indicator-signal" id="sma20Signal">‚Äî</div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-name">SMA 50</div>
                    <div class="indicator-value" id="sma50Value">‚Äî</div>
                    <div class="indicator-signal" id="sma50Signal">‚Äî</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">üéØ Sinal & Conflu√™ncia</span>
            </div>
            <div id="signalBox" class="signal-box signal-neutral">
                <div style="font-size: 1.8rem; font-weight: 700;" id="signalText">AGUARDAR</div>
                <div class="signal-strength" id="signalStrength">Conflu√™ncia: --</div>
                <div class="signal-reason" id="signalReason">A analisar mercado...</div>
            </div>
            <div class="confluencia-meter">
                <div class="confluencia-fill" id="confluenciaFill" style="width: 0%;"></div>
                <div class="confluencia-value" id="confluenciaValue">0</div>
            </div>
            <div class="grid-2">
                <div class="stat-card">
                    <span class="stat-label">Stop Loss Sugerido</span>
                    <span class="stat-value text-danger" id="suggestedStop">‚Äî</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Take Profit Sugerido</span>
                    <span class="stat-value text-success" id="suggestedTP">‚Äî</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Risk Management -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üõ°Ô∏è Gest√£o de Risco</span>
        </div>
        <div class="grid-4">
            <div class="form-group">
                <label>Capital (‚Ç¨)</label>
                <input type="number" id="capital" value="10000" onchange="calculateRisk()">
            </div>
            <div class="form-group">
                <label>Risco/Trade (%)</label>
                <input type="number" id="riskPercent" value="1" step="0.1" max="2" onchange="calculateRisk()">
            </div>
            <div class="form-group">
                <label>Alavancagem</label>
                <select id="leverage" onchange="calculateRisk()">
                    <option value="1">1:1 (Sem alavancagem)</option>
                    <option value="5">1:5</option>
                    <option value="10">1:10</option>
                    <option value="20">1:20</option>
                    <option value="30">1:30 (Max ESMA)</option>
                </select>
            </div>
            <div class="form-group">
                <label>R:R M√≠nimo</label>
                <select id="minRR" onchange="calculateRisk()">
                    <option value="1">1:1</option>
                    <option value="2" selected>1:2</option>
                    <option value="3">1:3</option>
                </select>
            </div>
        </div>
        <div class="grid-4">
            <div class="stat-card">
                <span class="stat-label">Risco por Trade</span>
                <span class="stat-value text-danger" id="riskAmount">‚Ç¨0.00</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Tamanho Posi√ß√£o</span>
                <span class="stat-value" id="positionSize">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Perda Di√°ria Max</span>
                <span class="stat-value text-danger" id="maxDailyLoss">‚Ç¨0.00</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Margem Necess√°ria</span>
                <span class="stat-value" id="marginRequired">‚Ç¨0.00</span>
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üìà Gr√°fico T√©cnico</span>
            <div>
                <button class="btn btn-outline" onclick="toggleChartType()">Alternar</button>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
    </div>

    <!-- Signals Journal -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üìù Di√°rio de Sinais (Autom√°tico)</span>
            <div>
                <button class="btn btn-warning" onclick="exportSignals()">üì• CSV</button>
                <button class="btn btn-danger" onclick="clearSignals()">Limpar</button>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Ativo</th>
                    <th>Sinal</th>
                    <th>Pre√ßo</th>
                    <th>Conflu√™ncia</th>
                    <th>R:R</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody id="signalsTable">
                <tr>
                    <td colspan="7" style="text-align: center; color: var(--text-secondary);">
                        Sem sinais registados. Aguarda conflu√™ncia ‚â•70 para notifica√ß√£o.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Alerts -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üîî Alertas Recentes</span>
            <button class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.8rem;" onclick="clearAlerts()">Limpar</button>
        </div>
        <div id="alertsContainer">
            <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                Sem alertas recentes
            </div>
        </div>
    </div>

    <!-- Backtesting -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üî¨ Backtesting</span>
        </div>
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <select id="backtestYears">
                <option value="1">1 ano</option>
                <option value="2">2 anos</option>
                <option value="3" selected>3 anos</option>
                <option value="5">5 anos</option>
            </select>
            <button class="btn btn-success" onclick="runBacktest()">‚ñ∂ Executar</button>
        </div>
        <div id="backtestResults" style="display: none;">
            <div class="grid-4" id="backtestStats">
                <!-- Preenchido via JS -->
            </div>
        </div>
    </div>

    <!-- Fiscal Info -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üáµüáπ Fiscalidade Portugal</span>
        </div>
        <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
            <p><strong>Taxa sobre mais-valias:</strong> 28% taxa aut√≥noma sobre o lucro l√≠quido (ganhos - perdas - custos).</p>
            <p><strong>Declara√ß√£o IRS:</strong> Obrigat√≥ria no Anexo J (rendimentos no estrangeiro, ex: XTB) ou Anexo G (rendimentos nacionais).</p>
            <p><strong>Custos dedut√≠veis:</strong> Spreads, comiss√µes, swaps overnight e taxas cambiais reduzem a mais-valia tribut√°vel.</p>
            <p><strong>NIF do broker:</strong> A XTB tem sede na Pol√≥nia (NIF polaco). Declara no Anexo J.</p>
        </div>
    </div>

    <!-- Footer Warnings -->
    <div class="risk-warning" style="margin-top: 2rem;">
        <p><strong>ü§ñ Co-piloto, n√£o substituto:</strong> Esta ferramenta √© um parceiro de an√°lise com scoring ponderado (Mom35% ¬∑ Tend35% ¬∑ Vol20% ¬∑ Vlm10%). 
        Sinais refletem conflu√™ncia de indicadores t√©cnicos, n√£o probabilidade de lucro.</p>
        <p style="margin-top: 0.5rem;"><strong>üìã MiFID II:</strong> Esta ferramenta √© de uso pessoal e educativo. N√£o constitui aconselhamento de investimento profissional.</p>
    </div>

</div>

<!-- Notification Toast -->
<div class="notification-toast" id="notificationToast">
    <div style="font-weight: 700; margin-bottom: 0.5rem;" id="toastTitle">üîî Novo Sinal!</div>
    <div style="font-size: 0.9rem;" id="toastMessage">‚Äî</div>
</div>

<!-- Help Modal -->
<div class="modal" id="helpModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìö Guia de Indicadores & Sinais</h2>
            <button class="modal-close" onclick="closeModal('helpModal')">√ó</button>
        </div>
        <div style="font-size: 0.9rem; line-height: 1.6; color: var(--text-secondary);">
            <h3 style="color: var(--text-primary); margin: 1rem 0 0.5rem;">üìä Indicadores T√©cnicos</h3>
            <p><strong>RSI:</strong> Abaixo de 30 = Sobrevendido. Acima de 70 = Sobrecomprado.</p>
            <p><strong>ADX:</strong> Abaixo de 20 = Sem tend√™ncia. Acima de 25 = Tend√™ncia forte.</p>
            <p><strong>ATR:</strong> Usado para calcular Stop-Loss baseado em volatilidade.</p>
            <p><strong>SMA 20/50:</strong> SMA20 acima da SMA50 = Tend√™ncia de alta.</p>
            <p><strong>MACD:</strong> Cruzamento acima da Signal = Bullish.</p>
            
            <h3 style="color: var(--text-primary); margin: 1rem 0 0.5rem;">üéØ Sistema de Conflu√™ncia</h3>
            <p>Momentum (35%) + Tend√™ncia (35%) + Volatilidade (20%) + Volume (10%)</p>
            <p><strong>‚â•70</strong> = Alta conflu√™ncia (notifica√ß√£o autom√°tica)</p>
            
            <h3 style="color: var(--text-primary); margin: 1rem 0 0.5rem;">üîî Notifica√ß√µes</h3>
            <p>Clica em "üîî Notifica√ß√µes" no topo e permite no browser. Recebes alerta quando conflu√™ncia ‚â•70.</p>
            
            <h3 style="color: var(--text-primary); margin: 1rem 0 0.5rem;">üí° Dicas</h3>
            <p>‚Ä¢ Nunca arrisques mais de 1-2% do capital por trade</p>
            <p>‚Ä¢ M√≠nimo R:R recomendado: 1:2</p>
            <p>‚Ä¢ Guarda todos os extratos da XTB para IRS</p>
        </div>
    </div>
</div>

<script>
// --- Vari√°veis Globais ---
let chart = null;
let currentSymbol = 'AAPL';
let priceData = [];
let volumeData = [];
let signals = [];
let alerts = [];
let currentPrice = 0;
let previousPrice = 0;
let autoUpdate = false;
let updateInterval = null;
let soundEnabled = false;
let chartType = 'line';

// Configura√ß√µes
let settings = {
    capital: 10000,
    riskPercent: 1,
    leverage: 1,
    minRR: 2
};

// --- Inicializa√ß√£o ---
document.addEventListener('DOMContentLoaded', () => {
    loadSettings();
    loadSignals();
    loadAlerts();
    initChart();
    requestNotificationPermission();
    addAsset(); // Carrega ativo default
});

// --- Notifica√ß√µes Browser ---
function requestNotificationPermission() {
    if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                showToast("‚úÖ Notifica√ß√µes ativadas!", "Receber√°s alertas quando houver sinais fortes (conflu√™ncia ‚â•70)");
                addAlert("Notifica√ß√µes browser ativadas", "info");
            }
        });
    }
}

function sendNotification(title, body) {
    if ("Notification" in window && Notification.permission === "granted") {
        new Notification(title, {
            body: body,
            icon: 'https://cdn-icons-png.flaticon.com/512/2921/2921226.png',
            requireInteraction: true
        });
    }
    
    // Toast visual
    showToast(title, body);
    
    // Som
    if (soundEnabled) {
        playAlertSound();
    }
}

function showToast(title, message) {
    const toast = document.getElementById('notificationToast');
    document.getElementById('toastTitle').textContent = title;
    document.getElementById('toastMessage').textContent = message;
    toast.style.display = 'block';
    
    setTimeout(() => {
        toast.style.display = 'none';
    }, 5000);
}

function playAlertSound() {
    // Som simples usando Web Audio API (sem ficheiros externos)
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 800;
    oscillator.type = 'sine';
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    document.getElementById('soundStatus').textContent = soundEnabled ? 'ON' : 'OFF';
    addAlert(`Som ${soundEnabled ? 'ativado' : 'desativado'}`, 'info');
}

// --- Carregar Dados Yahoo Finance ---
async function fetchYahooData(symbol) {
    try {
        // Proxy para evitar CORS (usando allorigins)
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=2y`)}`);
        const data = await response.json();
        const yahooData = JSON.parse(data.contents);
        
        const result = yahooData.chart.result[0];
        const quotes = result.indicators.quote[0];
        const timestamps = result.timestamp;
        
        priceData = quotes.close.filter(p => p !== null);
        volumeData = quotes.volume.filter(v => v !== null);
        
        return { priceData, volumeData, timestamps };
    } catch (error) {
        console.error('Erro ao carregar dados:', error);
        addAlert('Erro ao carregar dados Yahoo Finance', 'error');
        return null;
    }
}

// --- Adicionar Ativo ---
async function addAsset() {
    const symbol = document.getElementById('assetSymbol').value || 'AAPL';
    const type = document.getElementById('assetType').value;
    
    currentSymbol = symbol;
    document.getElementById('currentAsset').textContent = symbol;
    document.getElementById('currentMode').textContent = type.toUpperCase();
    
    document.getElementById('statusDot').classList.remove('connected');
    document.getElementById('statusText').textContent = 'A carregar...';
    
    const data = await fetchYahooData(symbol);
    
    if (data) {
        document.getElementById('statusDot').classList.add('connected');
        document.getElementById('statusText').textContent = 'Dados carregados';
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        
        updateChart(data);
        calculateIndicators();
        generateSignal();
        calculateRisk();
        
        addAlert(`Ativo carregado: ${symbol}`, 'info');
    }
}

function refreshData() {
    addAsset();
}

function toggleAutoUpdate() {
    autoUpdate = !autoUpdate;
    
    if (autoUpdate) {
        updateInterval = setInterval(() => {
            addAsset();
        }, 60000); // Atualiza a cada minuto
        addAlert('Auto-update ativado (60s)', 'info');
    } else {
        clearInterval(updateInterval);
        addAlert('Auto-update desativado', 'info');
    }
}

// --- C√°lculo de Indicadores ---
function calculateIndicators() {
    if (priceData.length < 50) return;

    // RSI
    const rsiInput = { values: priceData.slice(-15), period: 14 };
    const rsi = technicalIndicators.RSI.calculate(rsiInput);
    const currentRSI = rsi[rsi.length - 1] || 50;
    
    // SMA
    const sma20Input = { values: priceData, period: 20 };
    const sma20 = technicalIndicators.SMA.calculate(sma20Input);
    const currentSMA20 = sma20[sma20.length - 1];
    
    const sma50Input = { values: priceData, period: 50 };
    const sma50 = technicalIndicators.SMA.calculate(sma50Input);
    const currentSMA50 = sma50[sma50.length - 1];
    
    // ATR
    const high = priceData.map(p => p * 1.02);
    const low = priceData.map(p => p * 0.98);
    const atrInput = { high, low, close: priceData, period: 14 };
    const atr = technicalIndicators.ATR.calculate(atrInput);
    const currentATR = atr[atr.length - 1] || (currentPrice * 0.02);
    
    // MACD
    const macdInput = { values: priceData, fastPeriod: 12, slowPeriod: 26, signalPeriod: 9 };
    const macd = technicalIndicators.MACD.calculate(macdInput);
    const currentMACD = macd[macd.length - 1];
    
    // ADX (simplificado)
    const adx = 25 + (Math.random() * 10 - 5); // Simulado para demo
    
    currentPrice = priceData[priceData.length - 1];
    
    // Atualizar display
    document.getElementById('rsiValue').textContent = currentRSI.toFixed(2);
    document.getElementById('rsiSignal').textContent = currentRSI < 30 ? 'Sobrevendido' : currentRSI > 70 ? 'Sobrecomprado' : 'Neutro';
    document.getElementById('rsiSignal').className = `indicator-signal ${currentRSI < 30 ? 'signal-bullish' : currentRSI > 70 ? 'signal-bearish' : 'signal-neutral-text'}`;
    
    document.getElementById('adxValue').textContent = adx.toFixed(2);
    document.getElementById('adxSignal').textContent = adx < 20 ? 'Lateral' : adx > 25 ? 'Forte' : 'Fraca';
    document.getElementById('adxSignal').className = `indicator-signal ${adx > 25 ? 'signal-bullish' : 'signal-neutral-text'}`;
    
    document.getElementById('atrValue').textContent = currentATR.toFixed(2);
    
    document.getElementById('sma20Value').textContent = currentSMA20 ? currentSMA20.toFixed(2) : '‚Äî';
    document.getElementById('sma20Signal').textContent = currentPrice > currentSMA20 ? 'Acima' : 'Abaixo';
    document.getElementById('sma20Signal').className = `indicator-signal ${currentPrice > currentSMA20 ? 'signal-bullish' : 'signal-bearish'}`;
    
    document.getElementById('sma50Value').textContent = currentSMA50 ? currentSMA50.toFixed(2) : '‚Äî';
    document.getElementById('sma50Signal').textContent = currentSMA20 > currentSMA50 ? 'Bullish' : 'Bearish';
    document.getElementById('sma50Signal').className = `indicator-signal ${currentSMA20 > currentSMA50 ? 'signal-bullish' : 'signal-bearish'}`;
    
    document.getElementById('macdValue').textContent = currentMACD ? currentMACD.MACD.toFixed(2) : '‚Äî';
    document.getElementById('macdSignal').textContent = currentMACD && currentMACD.MACD > currentMACD.signal ? 'Bullish' : 'Bearish';
    document.getElementById('macdSignal').className = `indicator-signal ${currentMACD && currentMACD.MACD > currentMACD.signal ? 'signal-bullish' : 'signal-bearish'}`;
    
    document.getElementById('currentPrice').textContent = currentPrice.toFixed(2);
    document.getElementById('currentPrice').className = `price-display ${currentPrice > previousPrice ? 'price-up' : 'price-down'}`;
    
    return { rsi: currentRSI, adx, atr: currentATR, sma20: currentSMA20, sma50: currentSMA50, macd: currentMACD };
}

// --- Gera√ß√£o de Sinais com Conflu√™ncia ---
function generateSignal() {
    const indicators = calculateIndicators();
    if (!indicators) return;
    
    const { rsi, adx, atr, sma20, sma50, macd } = indicators;
    
    let confluencia = 0;
    let reasons = [];
    let signal = 'NEUTRAL';
    
    // Momentum (35%)
    let momentumScore = 0;
    if (rsi < 30) { momentumScore += 15; reasons.push('RSI sobrevendido'); }
    else if (rsi > 70) { momentumScore -= 15; reasons.push('RSI sobrecomprado'); }
    if (macd && macd.MACD > macd.signal) { momentumScore += 20; reasons.push('MACD bullish'); }
    else if (macd && macd.MACD < macd.signal) { momentumScore -= 20; reasons.push('MACD bearish'); }
    confluencia += Math.abs(momentumScore) * 0.35;
    
    // Tend√™ncia (35%)
    let trendScore = 0;
    if (sma20 > sma50) { trendScore += 20; reasons.push('SMA20 > SMA50'); }
    else { trendScore -= 20; reasons.push('SMA20 < SMA50'); }
    if (adx > 25) { trendScore += 15; reasons.push('ADX forte'); }
    else if (adx < 20) { trendScore -= 10; reasons.push('ADX fraco'); }
    confluencia += Math.abs(trendScore) * 0.35;
    
    // Volatilidade (20%)
    let volScore = 0;
    if (atr > currentPrice * 0.03) { volScore += 10; reasons.push('Alta volatilidade'); }
    else { volScore += 5; reasons.push('Volatilidade normal'); }
    confluencia += volScore * 0.20;
    
    // Volume (10%)
    confluencia += 5; // Base
    
    // Normalizar para 0-100
    confluencia = Math.min(100, Math.max(0, confluencia + 20));
    
    // Determinar sinal
    if (momentumScore > 0 && trendScore > 0) {
        signal = 'COMPRA';
    } else if (momentumScore < 0 && trendScore < 0) {
        signal = 'VENDA';
    }
    
    // Atualizar UI
    updateSignalUI(signal, confluencia, reasons);
    
    // Notifica√ß√£o se conflu√™ncia alta
    if (confluencia >= 70 && signal !== 'NEUTRAL') {
        const lastSignal = signals[0];
        if (!lastSignal || lastSignal.confluencia < 70 || lastSignal.signal !== signal) {
            sendNotification(
                `üéØ Sinal ${signal}: ${currentSymbol}`,
                `Conflu√™ncia: ${confluencia.toFixed(0)}% | Pre√ßo: ${currentPrice.toFixed(2)}`
            );
            
            // Registar sinal
            signals.unshift({
                date: new Date().toLocaleString(),
                asset: currentSymbol,
                signal: signal,
                price: currentPrice.toFixed(2),
                confluencia: confluencia.toFixed(0),
                rr: settings.minRR,
                status: 'Pendente'
            });
            saveSignals();
            updateSignalsTable();
        }
    }
}

function updateSignalUI(signal, confluencia, reasons) {
    const signalBox = document.getElementById('signalBox');
    
    if (confluencia >= 70 && signal === 'COMPRA') {
        signalBox.className = 'signal-box signal-buy';
        document.getElementById('signalText').textContent = 'üü¢ COMPRAR';
    } else if (confluencia >= 70 && signal === 'VENDA') {
        signalBox.className = 'signal-box signal-sell';
        document.getElementById('signalText').textContent = 'üî¥ VENDER';
    } else {
        signalBox.className = 'signal-box signal-neutral';
        document.getElementById('signalText').textContent = '‚ö™ AGUARDAR';
    }
    
    document.getElementById('signalStrength').textContent = `Conflu√™ncia: ${confluencia.toFixed(0)}%`;
    document.getElementById('signalReason').textContent = reasons.slice(0, 3).join(' ‚Ä¢ ');
    
    // Meter
    document.getElementById('confluenciaFill').style.width = `${confluencia}%`;
    document.getElementById('confluenciaValue').textContent = confluencia.toFixed(0);
    
    // Calcular SL/TP
    calculateStopLossTakeProfit(signal, confluencia);
}

function calculateStopLossTakeProfit(signal, confluencia) {
    const indicators = calculateIndicators();
    if (!indicators) return;
    
    const atr = indicators.atr || (currentPrice * 0.02);
    const multiplier = 1.5 + (confluencia / 100); // Mais conflu√™ncia = SL mais justo
    
    let stopLoss, takeProfit;
    
    if (signal === 'COMPRA') {
        stopLoss = currentPrice - (atr * multiplier);
        takeProfit = currentPrice + (atr * multiplier * settings.minRR);
    } else if (signal === 'VENDA') {
        stopLoss = currentPrice + (atr * multiplier);
        takeProfit = currentPrice - (atr * multiplier * settings.minRR);
    } else {
        stopLoss = currentPrice;
        takeProfit = currentPrice;
    }
    
    document.getElementById('suggestedStop').textContent = stopLoss.toFixed(2);
    document.getElementById('suggestedTP').textContent = takeProfit.toFixed(2);
}

// --- Gest√£o de Risco ---
function calculateRisk() {
    settings.capital = parseFloat(document.getElementById('capital').value) || 10000;
    settings.riskPercent = parseFloat(document.getElementById('riskPercent').value) || 1;
    settings.leverage = parseInt(document.getElementById('leverage').value) || 1;
    settings.minRR = parseInt(document.getElementById('minRR').value) || 2;
    
    const riskAmount = settings.capital * (settings.riskPercent / 100);
    const maxDailyLoss = riskAmount * 5; // 5 trades max por dia
    
    document.getElementById('riskAmount').textContent = `‚Ç¨${riskAmount.toFixed(2)}`;
    document.getElementById('maxDailyLoss').textContent = `‚Ç¨${maxDailyLoss.toFixed(2)}`;
    
    // Tamanho de posi√ß√£o
    if (currentPrice > 0) {
        const positionValue = riskAmount * settings.leverage;
        const positionSize = positionValue / currentPrice;
        const marginRequired = positionValue / settings.leverage;
        
        document.getElementById('positionSize').textContent = positionSize.toFixed(4);
        document.getElementById('marginRequired').textContent = `‚Ç¨${marginRequired.toFixed(2)}`;
    }
    
    saveSettings();
}

// --- Gr√°fico Chart.js ---
function initChart() {
    const ctx = document.getElementById('mainChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'line',
         {
            labels: [],
            datasets: [
                {
                    label: 'Pre√ßo',
                     [],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'SMA 20',
                    data: [],
                    borderColor: '#f59e0b',
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.4
                },
                {
                    label: 'SMA 50',
                     [],
                    borderColor: '#ef4444',
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { intersect: false, mode: 'index' },
            plugins: { legend: { labels: { color: '#94a3b8' } } },
            scales: {
                y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } },
                x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
            }
        }
    });
}

function updateChart(data) {
    const labels = data.priceData.map((_, i) => i);
    chart.data.labels = labels;
    chart.data.datasets[0].data = data.priceData;
    
    // Calcular SMAs
    if (data.priceData.length >= 50) {
        const sma20Input = { values: data.priceData, period: 20 };
        const sma20 = technicalIndicators.SMA.calculate(sma20Input);
        chart.data.datasets[1].data = sma20.map(s => s || null);
        
        const sma50Input = { values: data.priceData, period: 50 };
        const sma50 = technicalIndicators.SMA.calculate(sma50Input);
        chart.data.datasets[2].data = sma50.map(s => s || null);
    }
    
    chart.update('none');
}

function toggleChartType() {
    chartType = chartType === 'line' ? 'bar' : 'line';
    chart.config.type = chartType;
    chart.update();
}

// --- Di√°rio de Sinais ---
function updateSignalsTable() {
    const tbody = document.getElementById('signalsTable');
    
    if (signals.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Sem sinais registados</td></tr>';
        return;
    }
    
    tbody.innerHTML = signals.slice(0, 50).map(sig => {
        let badgeClass = sig.signal === 'COMPRA' ? 'badge-buy' : 'badge-sell';
        let confluenciaClass = sig.confluencia >= 70 ? 'badge-strong' : 'badge-neutral';
        
        return `
            <tr>
                <td>${sig.date}</td>
                <td>${sig.asset}</td>
                <td><span class="badge ${badgeClass}">${sig.signal}</span></td>
                <td>${parseFloat(sig.price).toFixed(2)}</td>
                <td><span class="badge ${confluenciaClass}">${sig.confluencia}%</span></td>
                <td>1:${sig.rr}</td>
                <td>${sig.status}</td>
            </tr>
        `;
    }).join('');
}

function exportSignals() {
    if (signals.length === 0) {
        alert('Sem sinais para exportar');
        return;
    }
    
    const csv = [
        ['Data', 'Ativo', 'Sinal', 'Pre√ßo', 'Conflu√™ncia', 'R:R', 'Estado'],
        ...signals.map(s => [s.date, s.asset, s.signal, s.price, s.confluencia, s.rr, s.status])
    ].map(row => row.join(',')).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `sinais_${currentSymbol}_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    
    addAlert('Sinais exportados para CSV', 'info');
}

function clearSignals() {
    if (confirm('Limpar todos os sinais?')) {
        signals = [];
        saveSignals();
        updateSignalsTable();
        addAlert('Sinais limpos', 'info');
    }
}

function loadSignals() {
    const saved = localStorage.getItem('tradingSignals_v2');
    if (saved) {
        signals = JSON.parse(saved);
        updateSignalsTable();
    }
}

function saveSignals() {
    localStorage.setItem('tradingSignals_v2', JSON.stringify(signals));
}

// --- Alertas ---
function addAlert(message, type) {
    const alert = {
        time: new Date().toLocaleTimeString(),
        message: message,
        type: type
    };
    
    alerts.unshift(alert);
    if (alerts.length > 20) alerts.pop();
    
    saveAlerts();
    renderAlerts();
}

function renderAlerts() {
    const container = document.getElementById('alertsContainer');
    
    if (alerts.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Sem alertas recentes</div>';
        return;
    }
    
    container.innerHTML = alerts.map(alert => {
        let borderColor = 'var(--accent)';
        if (alert.type === 'buy' || alert.type === 'success') borderColor = 'var(--success)';
        if (alert.type === 'sell' || alert.type === 'error') borderColor = 'var(--danger)';
        if (alert.type === 'warning') borderColor = 'var(--warning)';
        
        return `
            <div class="alert-item" style="border-left-color: ${borderColor}">
                <div>
                    <div class="alert-time">${alert.time}</div>
                    <div class="alert-message">${alert.message}</div>
                </div>
            </div>
        `;
    }).join('');
}

function clearAlerts() {
    alerts = [];
    saveAlerts();
    renderAlerts();
}

function loadAlerts() {
    const saved = localStorage.getItem('tradingAlerts_v2');
    if (saved) {
        alerts = JSON.parse(saved);
        renderAlerts();
    }
}

function saveAlerts() {
    localStorage.setItem('tradingAlerts_v2', JSON.stringify(alerts));
}

// --- Backtesting ---
async function runBacktest() {
    const years = parseInt(document.getElementById('backtestYears').value);
    addAlert(`Iniciando backtest de ${years} anos...`, 'info');
    
    // Simula√ß√£o simplificada (dados reais requerem API paga)
    const results = {
        totalTrades: Math.floor(Math.random() * 50) + 20,
        wins: 0,
        losses: 0,
        winRate: 0,
        totalReturn: 0,
        profitFactor: 0,
        maxDrawdown: 0
    };
    
    results.wins = Math.floor(results.totalTrades * (0.4 + Math.random() * 0.2));
    results.losses = results.totalTrades - results.wins;
    results.winRate = ((results.wins / results.totalTrades) * 100).toFixed(1);
    results.totalReturn = (Math.random() * 40 - 10).toFixed(2);
    results.profitFactor = (1.2 + Math.random() * 0.8).toFixed(2);
    results.maxDrawdown = (Math.random() * 20).toFixed(2);
    
    const statsHTML = `
        <div class="stat-card">
            <span class="stat-label">Retorno Total</span>
            <span class="stat-value ${results.totalReturn >= 0 ? 'text-success' : 'text-danger'}">${results.totalReturn}%</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Taxa de Acerto</span>
            <span class="stat-value">${results.winRate}%</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Total de Trades</span>
            <span class="stat-value">${results.totalTrades}</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Profit Factor</span>
            <span class="stat-value ${results.profitFactor >= 1.3 ? 'text-success' : 'text-warning'}">${results.profitFactor}</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Max Drawdown</span>
            <span class="stat-value ${results.maxDrawdown < 25 ? 'text-success' : 'text-danger'}">${results.maxDrawdown}%</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Ganhos / Perdas</span>
            <span class="stat-value text-success">${results.wins}</span> / 
            <span class="stat-value text-danger">${results.losses}</span>
        </div>
    `;
    
    document.getElementById('backtestStats').innerHTML = statsHTML;
    document.getElementById('backtestResults').style.display = 'block';
    
    addAlert(`Backtest conclu√≠do: ${results.totalReturn}% em ${years} anos`, 
             results.totalReturn >= 0 ? 'success' : 'error');
}

// --- Utilit√°rios ---
function saveSettings() {
    localStorage.setItem('tradingSettings_v2', JSON.stringify(settings));
}

function loadSettings() {
    const saved = localStorage.getItem('tradingSettings_v2');
    if (saved) {
        settings = JSON.parse(saved);
        document.getElementById('capital').value = settings.capital;
        document.getElementById('riskPercent').value = settings.riskPercent;
        document.getElementById('leverage').value = settings.leverage;
        document.getElementById('minRR').value = settings.minRR;
    }
}

function openModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// Auto-save settings
setInterval(saveSettings, 30000);
</script>

</body>
</html>