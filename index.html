<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Advisor Pessoal | Trading Dashboard</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { background-color: var(--bg-dark); color: var(--text-primary); padding-bottom: 50px; }

        /* Header */
        header { background: var(--bg-card); padding: 1rem 2rem; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; }
        h1 { font-size: 1.2rem; font-weight: 600; }
        .status-badge { background: rgba(16, 185, 129, 0.2); color: var(--success); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; }

        /* Grid Layout */
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }

        /* Cards */
        .card { background: var(--bg-card); border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; border-bottom: 1px solid #334155; padding-bottom: 0.5rem; }
        .card-title { font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }

        /* Inputs & Forms */
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary); }
        input, select, textarea { width: 100%; background: #0f172a; border: 1px solid #334155; color: white; padding: 0.75rem; border-radius: 6px; font-size: 0.95rem; }
        input:focus { outline: 2px solid var(--accent); border-color: transparent; }
        
        button { width: 100%; background: var(--accent); color: white; border: none; padding: 0.75rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button:hover { background: #2563eb; }
        button.danger { background: var(--danger); }
        button.danger:hover { background: #dc2626; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-box { background: #0f172a; padding: 1rem; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 700; display: block; }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th { text-align: left; color: var(--text-secondary); font-size: 0.8rem; padding: 0.5rem; border-bottom: 1px solid #334155; }
        td { padding: 0.75rem 0.5rem; border-bottom: 1px solid #334155; font-size: 0.9rem; }
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .badge-buy { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-sell { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        /* Alerts */
        .alert { padding: 1rem; border-radius: 6px; margin-bottom: 1rem; font-size: 0.9rem; display: none; }
        .alert-warning { background: rgba(245, 158, 11, 0.2); border: 1px solid var(--warning); color: var(--warning); }
        
        /* Utility */
        .hidden { display: none; }
        .full-width { grid-column: 1 / -1; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
    <div>
        <h1>üõ°Ô∏è Meu Advisor Pessoal</h1>
        <span style="font-size: 0.8rem; color: var(--text-secondary);">Ferramenta de Gest√£o de Risco & Di√°rio</span>
    </div>
    <div class="status-badge">Sistema Online</div>
</header>

<div class="container">
    
    <!-- Configura√ß√£o de Capital -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üí∞ Configura√ß√£o de Capital</span>
        </div>
        <div class="form-group">
            <label>Capital Total Dispon√≠vel (‚Ç¨)</label>
            <input type="number" id="totalCapital" value="10000" onchange="updateRiskCalc()">
        </div>
        <div class="form-group">
            <label>Risco M√°ximo por Opera√ß√£o (%)</label>
            <input type="number" id="riskPerTrade" value="1.0" step="0.1" onchange="updateRiskCalc()">
            <small style="color: var(--text-secondary); font-size: 0.75rem;">Recomendado: 1% a 2% para preserva√ß√£o de capital.</small>
        </div>
        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-value text-success" id="displayRiskAmount">‚Ç¨100.00</span>
                <span class="stat-label">Risco ‚Ç¨ por Trade</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="displayMaxLoss">‚Ç¨100.00</span>
                <span class="stat-label">Perda M√°x. Di√°ria (5 trades)</span>
            </div>
        </div>
    </div>

    <!-- Calculadora de Posi√ß√£o -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">üßÆ Calculadora de Posi√ß√£o</span>
        </div>
        <div id="riskAlert" class="alert alert-warning">
            ‚ö†Ô∏è Aten√ß√£o: O risco desta opera√ß√£o excede o teu limite definido!
        </div>
        <div class="form-group">
            <label>Ativo (ex: EURUSD, BTC, AAPL)</label>
            <input type="text" id="assetName" placeholder="Nome do Ativo">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label>Pre√ßo de Entrada</label>
                <input type="number" id="entryPrice" placeholder="0.00" oninput="calculatePosition()">
            </div>
            <div class="form-group">
                <label>Stop Loss</label>
                <input type="number" id="stopLoss" placeholder="0.00" oninput="calculatePosition()">
            </div>
        </div>
        <div class="form-group">
            <label>Tipo de Opera√ß√£o</label>
            <select id="tradeType" onchange="calculatePosition()">
                <option value="LONG">Compra (Long)</option>
                <option value="SHORT">Venda (Short)</option>
            </select>
        </div>
        
        <div class="stat-box" style="background: #0f172a; margin-bottom: 1rem; border: 1px solid var(--accent);">
            <span class="stat-label">Tamanho da Posi√ß√£o Recomendado</span>
            <span class="stat-value" id="positionSize" style="color: var(--accent);">0 Unidades</span>
            <span class="stat-label" id="positionValue">Valor Total: ‚Ç¨0.00</span>
        </div>

        <button onclick="openTrade()">‚úÖ Confirmar Entrada no Di√°rio</button>
    </div>

    <!-- Di√°rio de Trading -->
    <div class="card full-width">
        <div class="card-header">
            <span class="card-title">üìì Di√°rio de Opera√ß√µes (Abertas)</span>
            <button style="width: auto; padding: 0.5rem 1rem; font-size: 0.8rem;" onclick="clearClosedTrades()">Limpar Hist√≥ricos</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Ativo</th>
                    <th>Tipo</th>
                    <th>Entrada</th>
                    <th>Stop Loss</th>
                    <th>Risco (‚Ç¨)</th>
                    <th>Estado</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="openTradesTable">
                <!-- Trades inseridos via JS -->
            </tbody>
        </table>
    </div>

    <!-- Performance -->
    <div class="card full-width">
        <div class="card-header">
            <span class="card-title">üìà Performance Acumulada</span>
        </div>
        <div style="height: 300px;">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>

</div>

<script>
    // --- Estado da Aplica√ß√£o ---
    let appState = {
        capital: 10000,
        riskPercent: 1.0,
        trades: [],
        history: [] // Para o gr√°fico
    };

    // --- Inicializa√ß√£o ---
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        updateRiskCalc();
        renderTrades();
        initChart();
    });

    // --- L√≥gica de Risco ---
    function updateRiskCalc() {
        appState.capital = parseFloat(document.getElementById('totalCapital').value) || 0;
        appState.riskPercent = parseFloat(document.getElementById('riskPerTrade').value) || 0;
        
        const riskAmount = appState.capital * (appState.riskPercent / 100);
        
        document.getElementById('displayRiskAmount').innerText = `‚Ç¨${riskAmount.toFixed(2)}`;
        document.getElementById('displayMaxLoss').innerText = `‚Ç¨${(riskAmount * 5).toFixed(2)}`;
        
        saveData();
        calculatePosition(); // Recalcular se houver inputs preenchidos
    }

    function calculatePosition() {
        const entry = parseFloat(document.getElementById('entryPrice').value);
        const stop = parseFloat(document.getElementById('stopLoss').value);
        const type = document.getElementById('tradeType').value;
        const riskAmount = appState.capital * (appState.riskPercent / 100);

        if (!entry || !stop) {
            document.getElementById('positionSize').innerText = "0 Unidades";
            document.getElementById('positionValue').innerText = "Valor Total: ‚Ç¨0.00";
            return;
        }

        // C√°lculo simples de tamanho de posi√ß√£o baseado no risco
        let difference = Math.abs(entry - stop);
        if (difference === 0) return;

        let units = riskAmount / difference;
        let totalValue = units * entry;

        document.getElementById('positionSize').innerText = `${units.toFixed(2)} Unidades`;
        document.getElementById('positionValue').innerText = `Valor Total: ‚Ç¨${totalValue.toFixed(2)}`;

        // Alerta de alavancagem impl√≠cita se o valor for muito maior que o capital
        // (Simplificado para este exemplo)
    }

    // --- Gest√£o de Trades ---
    function openTrade() {
        const asset = document.getElementById('assetName').value;
        const entry = parseFloat(document.getElementById('entryPrice').value);
        const stop = parseFloat(document.getElementById('stopLoss').value);
        const type = document.getElementById('tradeType').value;

        if (!asset || !entry || !stop) {
            alert("Por favor preenche todos os campos da opera√ß√£o.");
            return;
        }

        const riskAmount = appState.capital * (appState.riskPercent / 100);
        
        const trade = {
            id: Date.now(),
            date: new Date().toLocaleDateString(),
            asset: asset,
            type: type,
            entry: entry,
            stop: stop,
            risk: riskAmount,
            status: 'Aberta',
            closePrice: null,
            pnl: 0
        };

        appState.trades.unshift(trade); // Adiciona no topo
        saveData();
        renderTrades();
        
        // Limpar campos
        document.getElementById('assetName').value = '';
        document.getElementById('entryPrice').value = '';
        document.getElementById('stopLoss').value = '';
    }

    function closeTrade(id) {
        const closePrice = prompt("Pre√ßo de Fechamento:");
        if (!closePrice) return;

        const tradeIndex = appState.trades.findIndex(t => t.id === id);
        if (tradeIndex === -1) return;

        const trade = appState.trades[tradeIndex];
        const closeVal = parseFloat(closePrice);
        
        // Calcular PnL
        let pnl = 0;
        if (trade.type === 'LONG') {
            pnl = (closeVal - trade.entry) * (trade.risk / Math.abs(trade.entry - trade.stop));
        } else {
            pnl = (trade.entry - closeVal) * (trade.risk / Math.abs(trade.entry - trade.stop));
        }

        trade.status = 'Fechada';
        trade.closePrice = closeVal;
        trade.pnl = pnl;

        // Mover para hist√≥rico
        appState.history.push({
            date: new Date().toLocaleDateString(),
            pnl: pnl
        });

        // Remover de abertas
        appState.trades.splice(tradeIndex, 1);
        
        saveData();
        renderTrades();
        updateChart();
    }

    function renderTrades() {
        const tbody = document.getElementById('openTradesTable');
        tbody.innerHTML = '';

        appState.trades.forEach(trade => {
            const row = `
                <tr>
                    <td>${trade.date}</td>
                    <td><strong>${trade.asset}</strong></td>
                    <td><span class="badge ${trade.type === 'LONG' ? 'badge-buy' : 'badge-sell'}">${trade.type}</span></td>
                    <td>${trade.entry}</td>
                    <td style="color: var(--danger)">${trade.stop}</td>
                    <td>‚Ç¨${trade.risk.toFixed(2)}</td>
                    <td><span style="color: var(--warning)">‚óè Aberta</span></td>
                    <td><button style="width: auto; padding: 4px 8px; font-size: 0.8rem; background: var(--success);" onclick="closeTrade(${trade.id})">Fechar</button></td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

        if (appState.trades.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">Nenhuma opera√ß√£o aberta. Mant√©m a disciplina!</td></tr>';
        }
    }

    // --- Persist√™ncia (LocalStorage) ---
    function saveData() {
        localStorage.setItem('myAdvisorData', JSON.stringify(appState));
    }

    function loadData() {
        const data = localStorage.getItem('myAdvisorData');
        if (data) {
            appState = JSON.parse(data);
            document.getElementById('totalCapital').value = appState.capital;
            document.getElementById('riskPerTrade').value = appState.riskPercent;
        }
    }

    function clearClosedTrades() {
        if(confirm("Isso apagar√° o hist√≥rico de gr√°ficos. Continuar?")) {
            appState.history = [];
            saveData();
            updateChart();
        }
    }

    // --- Gr√°fico (Chart.js) ---
    let chartInstance = null;

    function initChart() {
        const ctx = document.getElementById('performanceChart').getContext('2d');
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Evolu√ß√£o do Capital (‚Ç¨)',
                    data: [],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: '#334155' } },
                    x: { grid: { display: false } }
                }
            }
        });
        updateChart();
    }

    function updateChart() {
        if (!chartInstance) return;
        
        // Simular capital inicial + acumulado
        let currentCapital = appState.capital;
        let labels = ['In√≠cio'];
        let dataPoints = [currentCapital];

        appState.history.forEach((h, index) => {
            currentCapital += h.pnl;
            labels.push(`Trade ${index + 1}`);
            dataPoints.push(currentCapital);
        });

        chartInstance.data.labels = labels;
        chartInstance.data.datasets[0].data = dataPoints;
        
        // Cor din√¢mica baseada em lucro/preju√≠zo final
        const color = dataPoints[dataPoints.length - 1] >= appState.capital ? '#10b981' : '#ef4444';
        chartInstance.data.datasets[0].borderColor = color;
        chartInstance.data.datasets[0].backgroundColor = color === '#10b981' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
        
        chartInstance.update();
    }
</script>

</body>
</html>